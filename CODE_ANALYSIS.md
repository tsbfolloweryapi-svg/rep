АНАЛИЗ ПРОЕКТА: Сойкин_Святослав (Tasks 1-4)
============================================

Дата анализа: 09.02.2026
Охват: 4 задания, ~60 файлов

????????????????????????????????????????????????????????????????????????????????????

1. ДУБЛИРОВАНИЕ КОДА И ИЗБЫТОЧНОСТЬ
????????????????????????????????????

1.1 Task 2 - Повторяющаяся структура методов (App.cpp)
--------------------------------------------------------
Методы: doFreqDictWords, doFreqDictLetters, doSwapLines, doWordsCapitalize, doOrderByLen
Проблема: Одинаковая структура
  1. cls()
  2. viewText(...) 
  3. getKey(...)
  4. try-catch блок с TextProcessor::функция(fileName_)
  5. show(...) или viewText выходного файла
  6. getKey(...) для продолжения

Советование: Факторизовать в шаблон функции:
  template<typename Processor>
  void executeFileOperation(const string& title, Processor p)

Масштаб дублирования: ~200 строк повторяющегося кода


1.2 Task1 - Избыточные комментарии "Работа с файлом"
------------------------------------------------------
В файле App.cpp встречаются подряд идентичные заголовки:
  // Работа с файлом
  void App::saveToBinary() const { ... }
  
  // Работа с файлом
  void App::loadFromBinary() { ... }
  
  // Работа с файлом
  void App::run() { ... }

Проблема: скрипт insert_section_comments.py добавил одинаковые заголовки подряд
Рекомендация: пересмотреть логику распределения заголовков в скрипте или вручную 
  укрупнить комментарии


1.3 Task 3 & 4 - Похожие методы выборки/сортировки
----------------------------------------------------
Requests и Payers имеют одинаковую сигнатуру методов:
  list<T> selectBy*(const Criteria&) const {...}
  void sortBy*() {...}

Потенциал факторизации:
  - Шаблонные функции select/sort
  - Generic Criteria pattern
  - Виртуальные классы для Comparable/Filterable

----------------------------------------------------------------------------------------

2. ОТСУТСТВИЕ ЗАЩИТЫ И ПРОБЛЕМЫ БЕЗОПАСНОСТИ
????????????????????????????????????????

2.1 Утечки ресурсов при исключениях
-----------------------------------
Пример из Task2/App.cpp (doSwapLines):
  fstream in(fileName_, ios::in);  // <-- Конструктор
  if (!in.is_open()) throw ...;
  in.imbue(locale(".1251"));
  
  // Здесь если выбросится исключение ДО in.close():
  vector<string> lines;
  while (getline(in, line)) lines.push_back(line);
  // ... весь оставшийся код может выбросить исключение
  
  in.close(); // <-- Может не вызваться!

Решение: Использовать scope-guard или RAII:
  {
    ifstream in(fileName_);  // auto-close при выходе из блока
    ...
  } // in автоматически закроется

Масштаб: найдено ~8-10 потенциальных утечек в Task2/App.cpp


2.2 Отсутствие валидации входных данных
-----------------------------------------
- selectByFlight(const string&) - нет проверки на пустую строку
- selectByDate(const Date&) - нет проверки на valid date (День, месяц)
- changePayer(int id) - нет проверки, есть ли такой id
- setDiscount(int d) - нет проверки, что d ? [0..100]

Рекомендация: Добавить валидацию с выбросом std::invalid_argument


2.3 Использование double для денежных сумм
--------------------------------------------
Payer::calculateSum() = timeMin_ * tariff_ * (1 - discount_ / 100.0)
Проблема: float/double имеют проблемы с точностью
  0.1 + 0.2 != 0.3 в double

Решение: Использовать long long cents или Decimal тип
Масштаб: Task4, все платежи


2.4 Отсутствие обработки пустых результатов
---------------------------------------------
selectByFlight("ABC123") может вернуть пустой list, и App не проверяет:
  list<Request> results = requests_.selectByFlight("ABC123");
  // Если results пуст - что дальше?
  for (const auto& r : results) { ... } // ничего не напечатается

Рекомендация: Проверять isempty() и выводить "Результаты не найдены"

----------------------------------------------------------------------------------------

3. ПРОБЛЕМЫ АРХИТЕКТУРЫ И СТРУКТУРЫ
?????????????????????????????????

3.1 Нарушение SRP (Single Responsibility Principle)
---------------------------------------------------
App класс отвечает за:
  - Бизнес-логику (countNegative, selectByFlight, etc.)
  - Управление файлами (saveToBinary, loadFromCSV)
  - UI/взаимодействие с пользователем (viewText, show, cls)
  - Навигацию по меню

Решение: Разделить:
  - AppLogic / Service
  - FileManager / Repository
  - UI / Presenter
  - MenuController


3.2 Отсутствие интерфейсов (Interfaces/Abstract Classes)
----------------------------------------------------------
Task1, Task2, Task3, Task4 - каждый имеет свой App класс,
но они не наследуют от IApp или BaseApp.

Это затрудняет:
  - Тестирование (нельзя сделать mock)
  - Переиспользование кода
  - Полиморфизм


3.3 Плохая обработка ошибок
--------------------------
Смешивание exception() и std::runtime_error:
  throw exception(("Ошибка открытия " + fname + " для чтения").c_str());
  throw runtime_error(("Ошибка открытия " + fileName_).c_str());

Рекомендация: Выбрать одно и использовать везде (лучше std::exception иерархия)


3.4 Жесткая привязка к файлам
------------------------------
binFile_ = "task1_vector.bin"
csvFile_ = "task4_payers.csv"

Проблемы:
  - Невозможно изменить путь без пересборки
  - Конфликты при одновременном запуске разных программ
  - Нет абстракции для хранилища (File, DB, Memory)

Рекомендация: Параметризовать пути через config или DI

----------------------------------------------------------------------------------------

4. ЛОГИЧЕСКИЕ ОШИБКИ И НЕДОЧЁТЫ
??????????????????????????????

4.1 Task1 - Множественные loadFromBinary() вызовы
--------------------------------------------------
void App::run() {
  saveToBinary();
  step_countNegative();
  step_countOutsideInterval(a, b);
  // ...
  step_sortDescending();
  loadFromBinary();  // <-- Восстанавливаем ДЛЯ СЛЕДУЮЩЕЙ операции
  step_sortByAbsAscending();
  loadFromBinary();  // <-- ОПЯТЬ восстанавливаем
  step_moveOutsideIntervalToEnd(a, b);
  loadFromBinary();  // <-- И ЕЩЁ РАЗ
}

Проблема: Вектор перезагружается 3 раза подряд, что неэффективно
  и затемняет логику (зачем перезагружать перед каждой операцией?)

Вопрос: Требует ли задание эта перезагрузка или это ошибка?
  Если требует - добавить комментарий объяснения


4.2 Task2 - Утечка памяти при исключении (vector<string> lines)
----------------------------------------------------------------
Утечка памяти:
  vector<string> lines;
  while (getline(in, line)) {
    lines.push_back(line);
  }
  // Если дальше выбросится исключение, vector будет утечь
  // В C++ это не утечка (вектор удалится при выходе из scope),
  // НО файлы МОГУТ остаться незакрытыми

Меньший масштаб: используется vector, который будет удалён правильно,
но файлы остаются проблемой.


4.3 Task3/Task4 - Отсутствие транзакций при saveToCSV/saveToBinaryFixed
--------------------------------------------------------------------------
Если программа упадёт в середине записи файла:
  - Файл будет повреждён
  - Восстановление невозможно

Рекомендация: Писать в .tmp файл, потом переименовать (atomic swap)


4.4 Task2 - locale(".1251") вероятно неportable
-------------------------------------------------
in.imbue(locale(".1251"));

Проблема:
  - ".1251" - только на Windows
  - На Linux это "ru_RU.CP1251" или "ru_RU.UTF-8"
  - Не все системы поддерживают эту локаль

Рекомендация: Использовать UTF-8 везде или параметризовать локаль

----------------------------------------------------------------------------------------

5. ОТСУТСТВИЕ ТЕСТИРОВАНИЯ
????????????????????????

- Нет unit-тестов (Google Test, Catch2)
- Нет integration-тестов
- Вся логика в main() и App - сложно тестировать
- Невозможна автоматизация проверки корректности


Рекомендация:
  - Выделить бизнес-логику в чистые функции/класс
  - Писать unit-тесты для каждого метода
  - Пример:
    TEST(VectorOperations, CountNegativeElements) {
      vector<float> v = {-1.0f, 2.0f, -3.0f};
      EXPECT_EQ(countNegative(v), 2);
    }

----------------------------------------------------------------------------------------

6. СТИЛЬ И КВАЛИФИКАЦИЯ КОДА
???????????????????????????

6.1 Смешанное именование (camelCase/snake_case)
-----------------------------------------------
getRand() vs readFloatFromCin vs step_countNegative
getKey vs step_countNegative
setDate vs getName

Рекомендация: Выбрать одно (лучше camelCase для методов, UPPER_CASE для констант)


6.2 Отсутствие const-корректности
----------------------------------
saveToBinary() const  // ? правильно
loadFromBinary()      // ? должно быть const если не изменяет файл?

Даже для методов, которые только читают, нет const


6.3 Шумные строки вывода
------------------------
cout << "     " << title << "\n"
  << "     +" << setfill('-') << setw(112) << "-" << "+"

Проблемы:
  - Жестко закодированные ширины (112, 110)
  - Магические числа (3 пробела, 112 символов)
  - Сложно поддерживать при изменении формата

Рекомендация: Константы, параметры, форматирование функциями

----------------------------------------------------------------------------------------

7. СООТВЕТСТВИЕ ЗАДАНИЯМ
???????????????????????

? Task 1 (Работа с вектором):
  - Реализованы все операции
  - Есть бинарное хранилище
  - Есть отчёты

? Task 2 (Обработка текста):
  - Реализованы основные операции
  - Есть работа с файлами
  - ПРОБЛЕМА: Много дублированного кода в методах

? Task 3 (Запросы авиакассы):
  - Реализована система запросов
  - Есть сортировки и фильтры
  - Есть сохранение/загрузка

? Task 4 (система платежей):
  - Реализована система платежей
  - ПРОБЛЕМА: использование double для денег
  - ПРОБЛЕМА: отсутствие валидации дисконта (0..100)

----------------------------------------------------------------------------------------

ИТОГОВЫЕ РЕКОМЕНДАЦИИ (приоритизированы)
??????????????????????????????????????

КРИТИЧЕСКИЕ (нужно исправить):
  1. Исправить утечи ресурсов при исключениях (Task2, использовать RAII)
  2. Добавить валидацию входных данных (Task3, Task4)
  3. Использовать целые числа для денег вместо double (Task4)

ВАЖНЫЕ (нужно переделать):
  4. Факторизовать дублированный код в Task2
  5. Разделить ответственность (App -> AppLogic + FileManager + UI)
  6. Параметризовать файловые пути

ХОРОШИЕ (улучшить качество):
  7. Унифицировать обработку ошибок (одна иерархия exception)
  8. Добавить unit-тесты
  9. Выбрать одно имеющееся соглосование (camelCase везде)
  10. Использовать const правильно

----------------------------------------------------------------------------------------
